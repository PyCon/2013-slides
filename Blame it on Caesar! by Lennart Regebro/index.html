<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Blame it on Caesar!</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="blame.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress"><div class="step" step="0" data-x="0" data-y="0" data-rotate-z="-266.40676685733774"><h1 id="blame-it-on-caesar">Blame it on Caesar!</h1><h2 id="lennart-regebro">Lennart Regebro</h2><p>PyCon US 2013, Santa Clara, Grand Ballroom AB</p><marquee direction="up" scrolldelay="300">
<p><br/><br/><br/><br/><br/><br/>
Grand Ballroom AB, eh?<br/><br/><br/>
Why not in the "Great America" Ballroom?<br/><br/><br/>
I heard America was great.<br/><br/><br/>
It was smaller than I expected.<br/><br/><br/>
Didn't look that special either.<br/><br/><br/><br/><br/></p>
</marquee></div><div class="step" step="1" data-x="-275" data-y="1653" data-rotate-z="-251.05819642873433"><h1 id="calendaring">Calendaring</h1><img src="images/system.gif" alt="" width="600px" height="450px"></img><h2 id="measuring-time-in-celestial-cycles">Measuring time in celestial cycles</h2><div class="notes"><p>Calendaring is about keeping track of time, as measured in three celestial
cycles, the day, the month and the year.</p><p>The basic and unavoidable problem of calendaring is that none of
these periods fit into each other evenly, and that what leads to
various complexities, to which their are various solutions.</p><p>One place that has seen pretty much <em>all</em> of these solutions at
one time or another is Rome.</p></div></div><div class="step" step="2" data-x="-1073" data-y="3128" data-rotate-z="-232.10934404774278"><h1 id="roman-calendars">Roman calendars</h1><img src="images/rome2spqr.jpg" alt="" width="900px" height="529px"></img><h2 id="you-name-em-they-had-em">You name 'em, they had 'em</h2></div><div class="step" step="3" data-x="-2307" data-y="4263" data-rotate-z="-213.16049166675106"><h1 id="calendar-of-romulus">Calendar of Romulus</h1><ul><li>10 lunar months</li><li>2-3 <em>uncounted</em> lunar months!</li><li>Works for farming</li><li>Not so great for business</li></ul><div class="notes"><p>The Roman calendar was originally ten lunar months long, starting with
the first new moon of spring, and had two to three months of uncounted
time in the winter. This is an unusual solution to the problem of
synchronizing the months and the year, but there are other examples.</p><p>But having an uncounted time makes it pretty hard to make appointments, so
the uncounted time was replaced with two months, January and February.
That made the Roman calendar a <em>lunar calendar</em>.</p></div></div><div class="step" step="4" data-x="-3842" data-y="4937" data-rotate-z="-194.21163928575936"><h1 id="lunar-calendars">Lunar calendars</h1><ul><li>The year is 12 lunar months long</li><li>The year is out of sync with the seasons</li><li>Other examples: The Islamic calendar</li></ul><div class="notes"><p>But with lunar calendars, the year moves out of sync with the seasons by
10-11 days per year. To solve that a leap month was quickly introduced to
keep the seasons in sync with the year, making the roman calendar a
<em>lunisolar calendar</em>.</p></div></div><div class="step" step="5" data-x="-5513" data-y="5075" data-rotate-z="-175.2627869047678"><h1 id="lunisolar-calendars">Lunisolar calendars</h1><ul><li>The year is 12 or 13 lunar months long</li><li>Leap months keep the year in sync</li><li>Other examples: The Hebrew, Buddhist, Burmese, Babylonian, etc, etc...</li></ul><div class="notes"><p>Lunisolar calendars have been the most popular type through history,
because they keep track of both the moon and the sun.</p><p>But they are very complex, and you have to know what you are doing. But
the roman lunisolar calendar was largely decided by a the terrible
combination of politics and superstition that also gave us such wonderful
things as the Chinese cultural revolution and airport security, so the
calendar was a crap one, and it seems to have become two to four months
out of sync by 50 BC.</p><p>Enter the first villain of this talk, Gaius Julius Caesar.</p></div></div><div class="step" step="6" data-x="-7138" data-y="4664" data-rotate-z="-156.31393452377603"><h1 id="villain-1">Villain #1</h1><img src="images/caesar.JPG" alt="" width="248px" height="550px"></img><h2 id="gaius-julius-caesar">Gaius Julius Caesar</h2><div class="notes"><p>Gaius Julius Caesar decides to fix the problems by creating his own
calendar. He drops the leap month, and instead increases the length of
the months to compensate. That means there is no longer any connection
between the moon and the month, so the calendar is now a purely <em>solar
calendar</em>.</p></div></div><div class="step" step="7" data-x="-8541" data-y="3747" data-rotate-z="-137.36508214278442"><h1 id="solar-calendars">Solar calendars</h1><ul><li>The year follows the solstices/seasons</li><li>The moon is ignored completely</li><li>Examples: The French republican calendar, the Julian Calendar, the Ancient Egyptian calendar...</li></ul><div class="notes"><p>Because solar calendars drops the synchronization to the moon, they
can be a lot simpler than lunisolar calendars. But although the
Julian calendar drops the leap month and replaces it with a simpler
leap day, it keeps all the other complexities.</p></div></div><div class="step" step="8" id="cleopatra" data-x="-9571" data-y="2424" data-rotate-z="-118.41622976179269"><img src="images/cleopatra.jpg" alt="" width="594px" height="450px"></img><p>My calendar brings all the boys to the yard!</p><p>And they're like, it's better than yours.</p><p>Damn right, it's better than yours!</p><p>I could teach you, but I'd have to charge.</p><div class="notes"><p>Since he conquered Egypt, and Cleopatra, he was well acquainted with the
Egyptian solar calendar which have twelve months of 30 days and a little
holiday of five to six days at the end of the year.</p><p>It's dead simple, but for some reason he didn't use that, which is highly
unfortunate for us.</p><p>Instead he takes the old Roman calendar that had a mix of 29 and 31 day
months (because even numbers are unlucky), and moves them to be 30 and 31
days long, except for February that was 28 days long unless it is a leap
year. We then end up with months that are 28, 29, 30 or 31 days long,
more or less arbitrarily.</p></div></div><div class="step" step="9" data-x="-10115" data-y="838" data-rotate-z="-99.46737738080103"><h1 id="spot-the-patterns">Spot the patterns</h1><h2 id="id1">31 28 31 30 31 30 31 31 30 31 30 31</h2><h2 id="id2">31 28 31 30 31 30 31 31 30 31 30 31</h2><h2 id="id3">31 28 31 30 31 30 31 31 30 31 30 31</h2><h2 id="id4">31 29 31 30 31 30 31 31 30 31 30 31</h2><div class="notes"><p>It also ends up with a leap day that is inserted in the middle of the year,
and not at the end, adding even more complexity.</p><p>Julius also renames a month after himself, just because he can.</p><p>Thanks to the success of the Roman empire Julius calendar gets
forced unto many unsuspecting folks and brings general pandemonium
around the world.</p></div></div><div class="step" step="10" data-x="-10115" data-y="-838" data-rotate-z="-80.5326226192358"><img src="images/asterix-pancadaria1.jpg" alt="" width="900px" height="375px"></img><div class="notes"><p>Despite being pretty much the worst calendar ever made it has lasted
for 2000 years with only a minor upgrade in how to calculate leap years.
Proof that quality doesn't beat marketing.</p><p>But it's an unnecessarily complex calendar, and means you need to keep your
tongue straight.</p></div></div><div class="step" step="11" data-x="-9571" data-y="-2424" data-rotate-z="-61.5837702382428"><h1 id="leap-day">Leap Day!</h1><img src="images/bob_beamon.jpg" alt="" width="" height=""></img><div class="notes"><p>Of course, the rule for leap-years is unavoidable, you need to insert
an extra day from time to time to keep in sync.</p></div></div><div class="step" step="12" data-x="-8541" data-y="-3747" data-rotate-z="-42.63491785724983"><h1 id="february-24th">February 24th!</h1><h2 id="don-t-ask-why">Don't ask why</h2><div class="notes"><p>It used to be the 24th! Yup. It's the 29th now.</p></div></div><div class="step" step="13" data-x="-7138" data-y="-4664" data-rotate-z="-23.68606547625681"><h1 id="it-s-the-29th-now">It's the 29th now</h1><h2 id="except-in-hungary">Except in Hungary</h2><div class="notes"><p>But not Hungary, and I think, many other Orthodox countries.</p><p>But don't despir, it get's much worse.</p><p>Which day of February that is the leap day only matters for name
days, so most likely you don't have to care. The problem is that having
the leap day in the middle of the year pushes all following dates one day
forward, so it makes all calculations extra complicated.</p><p>And the more or less arbitrary lengths of months really doesn't help
anyone either. And the Gregorian week handling is just rubbing salt into
the wounds.</p></div></div><div class="step" step="14" data-x="-5513" data-y="-5075" data-rotate-z="-4.737213095263915"><h1 id="weeks">Weeks</h1><div class="notes"><p>I haven't mentioned weeks before, because they are not a celestial cycle.
Weeks are just arbitrary groupings of days.</p><p>The Romans had an eight day week, the Egyptians used a ten-day week and so
did the first french republic, as well as the early Soviet union. But ten
days proved to be too long, and the seven days from Judaism has prevailed.</p><p>But you can handle weeks in different ways. The way we treat weeks, like a
running cycle independent of the rest of the year means that although we
dropped the lunar month, we now have another period to deal with. And
although it's an even number of days, it doesn't fit into the months or
years, giving is more complexity.</p><p>The Egyptian calendar splits each month into 3 ten day weeks, with
the five or six day holiday not being a part of a week at all.
Calculating what day of the year, day of the week and week number as a
result is quite simple:</p></div></div><div class="step" step="15" id="egyptiancode" data-x="-3842" data-y="-4937" data-rotate-z="14.211639285729099"><h1 id="egyptian-calendar-math">Egyptian calendar math</h1><pre class="highlight code python"><span class="k">def</span> <span class="nf">day_of_year</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="n">day_of_month</span>

<span class="k">def</span> <span class="nf">day_of_week</span><span class="p">(</span><span class="n">day</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">day</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">weekno</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">((</span><span class="n">day_of_year</span><span class="p">(</span><span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span></pre><div class="notes"><p>You can't see this in the back, but it doesn't matter.</p><p>This is quite simple, and much of the complexity here is to deal
with having day one really be one, and not zero.</p><p>However in the Julian/Gregorian calendar these calculations are such a mess, that the
calculations of the week day and week number actually each have their own
huge Wikipedia page. Seriously.</p><p>This is the generally accepted simplest and fastest way of calculating these things:</p></div></div><div class="step" step="16" id="juliancode" data-x="-2307" data-y="-4263" data-rotate-z="33.1604916667221"><h1 id="julian-calendar-math">Julian calendar math</h1><pre class="highlight code python"><span class="n">MONTH_LENGHTS_STD</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">304</span><span class="p">,</span> <span class="mi">334</span><span class="p">]</span>
<span class="n">MONTH_LENGHTS_LYR</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">182</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">244</span><span class="p">,</span> <span class="mi">274</span><span class="p">,</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">335</span><span class="p">]</span>
<span class="n">MONTH_DAY_OF_WEEK</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">day_of_year</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">year</span> <span class="o">%</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">year</span> <span class="o">%</span> <span class="mi">100</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">MONTH_LENGHTS_LYR</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">MONTH_LENGHTS_STD</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">d</span> <span class="o">+</span> <span class="n">day</span>

<span class="k">def</span> <span class="nf">day_of_week</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">month</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">year</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">dow</span> <span class="o">=</span> <span class="p">(</span><span class="n">year</span> <span class="o">+</span> <span class="n">year</span><span class="o">//</span><span class="mi">4</span> <span class="o">-</span> <span class="n">year</span><span class="o">//</span><span class="mi">100</span> <span class="o">+</span> <span class="n">year</span><span class="o">//</span><span class="mi">400</span> <span class="o">+</span>
           <span class="n">MONTH_DAY_OF_WEEK</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">day</span><span class="p">)</span> <span class="o">%</span> <span class="mi">7</span>
    <span class="k">if</span> <span class="n">dow</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dow</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="k">return</span> <span class="n">dow</span>

<span class="k">def</span> <span class="nf">_weekno</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">day_of_year</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span> <span class="o">-</span>
            <span class="n">day_of_week</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span> <span class="o">//</span> <span class="mi">7</span>

<span class="k">def</span> <span class="nf">weekno</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="n">week</span> <span class="o">=</span> <span class="n">_weekno</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">week</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">week</span> <span class="o">=</span> <span class="n">_weekno</span><span class="p">(</span><span class="n">year</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">week</span> <span class="o">==</span> <span class="mi">53</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">_weekno</span><span class="p">(</span><span class="n">year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">week</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">week</span></pre><div class="notes"><p>That's a lot more complex, even though it actually cheats by using three pre-calculated lists.</p></div></div><div class="step" step="17" data-x="-1073" data-y="-3128" data-rotate-z="52.10934404771504"><h1 id="calendaring-and-you">Calendaring and you</h1><img src="images/1808968-1-b-code-monkey.jpg" alt="" width="" height=""></img><div class="notes"><p>That's a lot more complex, even though it actually cheats by using three pre-calculated lists.</p><p>So how does this complexity translate to your coding?</p></div></div><div class="step" step="18" data-x="-275" data-y="-1653" data-rotate-z="71.058196428708"><h1 id="there-is-calendaring">There is calendaring</h1><h1 id="bug-born-every-day">bug born every day!</h1><h1 id="always-wear-a-library">Always wear a library!</h1><div class="notes"><p>Well, it translates to "Never do this yourself unless you have to".
Always do all date calculations with a library. Let the calculations be
Somebody Else's Problem.</p></div></div><div class="step" step="19" data-x="-2800" data-y="0" data-rotate-z="-266.40676685733774"><h1 id="python">Python</h1><h2 id="datetime"><tt>datetime</tt></h2><div class="notes"><p>Python is lucky to have to datetime library in
the stdlib, and although perhaps not perfect, it's very good.</p><p>In contrast, Javascript's date handling is almost non-existent.</p></div></div><div class="step" step="20" data-x="-3471" data-y="1620" data-rotate-z="-225.00352440487097"><h1 id="javascript">Javascript</h1><img src="images/moment-js.jpg" alt="" width="" height=""></img><div class="notes"><p>There are a bunch of libraries out there, I haven't used any of
them enough to cast judgment, but Moment.js looks OK, except that it
perpetuates Java/Javascripts moronic zero-indexed month.</p></div></div><div class="step" step="21" data-x="-5091" data-y="2291" data-rotate-z="-180.0000000000157"><h1 id="javascript-has-zero-indexed-months">Javascript has zero-indexed months</h1><p>January is 0</p><p>December is 11</p><div class="notes"><p>Yes, both Java and Javascript has January as "0", even though nobody would
ever think of January as anything else than 1. And Year one is 1, day 1 of a
month is 1, so it's not even consistent.</p><p>And whose fault is that? Enter Villain number 2, James Gosling.</p></div></div><div class="step" step="22" data-x="-6712" data-y="1620" data-rotate-z="-134.99647559516046"><h1 id="villain-2">Villain #2</h1><img src="images/79697-james-gosling-the-father-of-java.jpg" alt="" width="699px" height="550px"></img><h2 id="james-gosling-created-java">James Gosling; created Java</h2><div class="notes"><p>Here we see James Gosling, creator of Java, putting a pie in the face
of a fake Bill Gates.</p><p>Obviously, James Gosling is not stupid. He just slipped up and made a
small mistake, we all do. But when you do it in an API, it never goes
away.</p><p>The only way to fix it not is to create a whole new Date object in Java
(and Javascript), which is of course something that should be done
pronto, and is likely to happen in the year never.</p><p>It also does something else wrong: it starts the week with Sunday.
Because Americans have this idea that the week starts with Sundays. But
how on earth can the first day of the week be a part of the week*end*?</p></div></div><div class="step" step="23" data-x="-7383" data-y="0" data-rotate-z="-90.0"><h1 id="you-put-the-first-day">You put the first day</h1><h1 id="into-the-week-end">into the week <strong>end</strong>?</h1><img src="images/ancientromanfacepalm.jpg" alt="" width="" height=""></img><div class="notes"><p>That makes no sense!</p></div></div><div class="step" step="24" data-x="-6712" data-y="-1620" data-rotate-z="-45.00352440487395"><h1 id="python-and-weekdays">Python and weekdays</h1><h2 id="weekday-uses-0-for-monday"><tt>weekday()</tt> uses <tt>0</tt> for Monday</h2><div class="notes"><p>And since the most popular start of the week globally is Monday, it's not
uncommon to use 0 as the day of the week for Monday. Pythons weekday()
function does that.</p><p>However, not only is that inconsistent with how people usually count,
which starts at 1, like years, months and days does, but it also means
that in the US the first day of the week from a human standpoint is
seventh day from the computers standpoint which has the value 6. That
confuses <em>everyone</em>.</p></div></div><div class="step" step="25" data-x="-5091" data-y="-2291" data-rotate-z="0"><h1 id="iso-and-weekdays">ISO and weekdays</h1><h2 id="isoweekday-uses-1-for-monday"><tt>isoweekday()</tt> uses <tt>1</tt> for Monday</h2><div class="notes"><p>ISO therefore has determined that Monday is the first day of the week,
day 1, and Sunday is the last day of the week, day 7.</p><p>This makes more sense, is more consistent and also supported by
Pythons isoweekday() function.</p><p>Using 1 for Monday also has the benefit that Sunday could be day 7 and/or
day 0, both which at least make some sort of sense that day 6 does not.</p></div></div><div class="step" step="26" data-x="-3471" data-y="-1620" data-rotate-z="45.003524404842764"><h1 id="always-use-1-for-monday">Always use 1 for Monday</h1><h2 id="and-7-for-sunday">And 7 for Sunday</h2><h2 id="or-possibly-0">Or possibly 0</h2><h3 id="but-never-ever-6">But never ever 6</h3><div class="notes"><p>So in your Python calendaring code <em>always</em> use isoweekday() and always
have Monday == 1.</p><p>I also try to accept both day 0 and day 7 for Sunday, when I need to
handle such code. It makes it more flexible.</p><p>But in deference to ISO, the code should return 7 for Sunday. Or
possibly 0. But never ever 6.</p></div></div><div class="step" step="27" data-x="1200" data-y="0" data-rotate-z="-266.40676685733774"><h1 id="time-zones">Time zones</h1><h2 id="a-brief-history-of-something-that-doesn-t-exist">A brief history of something that doesn't exist</h2><div class="notes"><p>And if that wasn't confusing enough now it's time to talk about
timezones, and time to debunk a myth.</p><p>The world is NOT split into 24 time zones. There has been several proposals
to do so, but that has never happened.</p><p>Instead every country has decided to adopt it's own standard time,
or in the case of big countries, several standard times.</p><p>Results of this situation are Nepal's standard time of 5 h and 45 m before
GMT, and standard time of Sweden between 1879 and 1900, which was 1h 14s</p><p>A timezone could be defined as an area that has the same standard time, but
what "the same" means here is a matter of taste that is made worse by
standard times usually varying both throughout history and also throughout
the year, thanks to the most evil thing in calendaring: Daylight saving.</p></div></div><div class="step" step="28" data-x="992" data-y="1646" data-rotate-z="-255.6059210001726"><h1 id="villain-3">Villain #3</h1><img src="images/mw103312.jpg" alt="" width="400px" height="550px"></img><h2 id="william-willet-invented-dst">William Willet; invented DST</h2><div class="notes"><p>And this is our next villain, William Willet, the man that made
daylight saving happen, because he thought other people were lazy and
should get up as early as he did.</p><p>As the timezone rules for different countries are different different years
you need a database over these changes, and such a database does indeed
exist. It's usually called "zoneinfo" or just "tz" or "The Olson database" from the guy
who started it.</p><p>zoneinfo also solves another problem the one of naming
timezones. Since timezones doesn't actually exist, they don't have
standardized names. Instead they usually called with some abbreviation, like
GMT, UTC or CET. But since these abbreviations always have a T in them, and
then also preferably an S for "Standard", there aren't that many different
abbreviations to choose from.</p></div></div><div class="step" step="29" data-x="381" data-y="3189" data-rotate-z="-241.20479319061877"><ul><li>BST: 5 different zones</li><li>CST: 4 different zones</li><li>IST: 4 different zones</li></ul><div class="notes"><p>The result are things like CST, meaning Central Standard
Time in the US, or Central Standard Time in Australia, or China Standard Time
or Chungyuan Standard Time, which is what they use in Taiwan, although it's
unusual that they call it that now, since Chungyuan is on the mainland.
Instead it's called Central Standard Time.</p></div></div><div class="step" step="30" data-x="-594" data-y="4532" data-rotate-z="-226.80366538106526"><ul><li>America/Chicago</li><li>Australia/Canberra</li><li>Asia/Shanghai</li><li>Asia/Taipei</li></ul><div class="notes"><p>The maintainers of the zoneinfo database instead came up with another naming
scheme which has become popular; Continent/City. They identify entities which
have always had the same standard time, such as Sweden. They then name that
timezone after the continent and the major city in that timezone:
Europe/Stockholm.</p></div></div><div class="step" step="31" data-x="-1872" data-y="5590" data-rotate-z="-212.40253757151137"><img src="images/wroclaw.jpg" alt="" width="" height=""></img><div class="notes"><p>But these are political rather than geographical entities, for good reasons.
For example, there is no special zone for the area of Poland that was German
before WWII. That means that if you calculate times for Wroc&#x142;aw using
Europe/Warsaw as the timezone, you will get an answer that is one hour wrong
for dates between the 15th and 30th April 1940, since Germany and Poland had
different daylight saving rules!</p><p>Also, there are no special time zones for political entities that only
existed before 1970.</p></div></div><div class="step" step="32" data-x="-3374" data-y="6297" data-rotate-z="-198.0014097619577"><h1 id="midnight-dst-change">Midnight DST change</h1><img src="images/graveyard.jpg" alt="" width="" height=""></img><h2 id="you-are-scaring-the-computer">You are scaring the computer</h2><div class="notes"><p>It also took some time to tweak the whole daylight saving idea. Quite often
the shift has been done at midnight, so that instead of becoming a new day,
suddenly there was another hour. Or it's done at 1am, moving the clock back
to midnight. Both ideas are bad ideas. Not only because loads of people are
still awake at that time, but because you get two midnights. This is
confusing to people, and even more confusing to computers.</p></div></div><div class="step" step="33" data-x="-5004" data-y="6608" data-rotate-z="-183.60028195240406"><pre class="highlight code python"><span class="o">&gt;&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">date</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">29</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">ValueError</span><span class="p">:</span> <span class="n">day</span> <span class="ow">is</span> <span class="n">out</span> <span class="n">of</span> <span class="nb">range</span> <span class="k">for</span> <span class="n">month</span></pre><div class="notes"><p>For example, a common way to check if a date is valid is to create a date
object with the date information and see what happens. In Python this works
fine.</p></div></div><div class="step" step="34" data-x="-6660" data-y="6503" data-rotate-z="-169.19915414285023"><pre class="highlight code javascript"><span class="nx">js</span><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">29</span><span class="p">);</span>
<span class="nx">Tue</span> <span class="nx">Mar</span> <span class="mi">01</span> <span class="mi">2011</span> <span class="mi">00</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0100</span> <span class="p">(</span><span class="nx">CET</span><span class="p">)</span></pre><div class="notes"><p>In Javascript it's a bit trickier, as the Date object doesn't make those checks.
So, to check if the date is valid, you have to do this:</p></div></div><div class="step" step="35" data-x="-8239" data-y="5990" data-rotate-z="-154.79802633329678"><pre class="highlight code javascript"><span class="nx">js</span><span class="o">&gt;</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">2011</span><span class="p">;</span> <span class="nx">m</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">d</span> <span class="o">=</span> <span class="mi">29</span><span class="p">;</span>
<span class="nx">js</span><span class="o">&gt;</span> <span class="nx">dt</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
<span class="nx">js</span><span class="o">&gt;</span> <span class="k">if</span> <span class="p">(</span><span class="nx">dt</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">(</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">y</span> <span class="o">||</span>
        <span class="nx">dt</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">(</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">m</span> <span class="o">||</span>
        <span class="nx">dt</span><span class="p">.</span><span class="nx">getDay</span><span class="p">(</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">d</span><span class="p">)</span> <span class="p">{</span>
  <span class="o">&gt;</span> <span class="p">(</span><span class="nx">Insert</span> <span class="nx">error</span> <span class="nx">handling</span> <span class="nx">here</span><span class="p">)</span>
  <span class="o">&gt;</span> <span class="p">}</span></pre><div class="notes"><p>Here you create the object, and then check if what you get is what you asked for.</p><p>But leads to some problems. I'd call them unexpected, except this is
date time handling we are talking about and problems are expected.</p></div></div><div class="step" step="36" data-x="-9640" data-y="5101" data-rotate-z="-140.39689852374298"><pre class="highlight code javascript"><span class="nx">$</span> <span class="nx">TZ</span><span class="o">=</span><span class="s1">'Europe/Rome'</span> <span class="nx">js</span>
<span class="nx">Rhino</span> <span class="mf">1.7</span> <span class="nx">release</span> <span class="mi">3</span> <span class="mi">2012</span> <span class="mi">02</span> <span class="mi">16</span>
<span class="nx">js</span><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="mi">1972</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
<span class="nx">Sat</span> <span class="nx">May</span> <span class="mi">27</span> <span class="mi">1972</span> <span class="mi">23</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0100</span> <span class="p">(</span><span class="nx">CET</span><span class="p">)</span></pre><div class="notes"><p>TA-DA! Suddenly, May 28th 1972 becomes an invalid date! This is
because Midnight that day doesn't really exist, the time so to speak
went directly from 1972-05-27 23:59:59 to 1972-05-28 01:00:00, but
there is some library somewhere that handles this incorrectly. new
Date(1972, 4, 28, 0, 0, 0) should really return "May 28 1972 01:00:00
GMT+0100 (CET)", but this is not what happens.</p><p>But this bug, probably in some C-library in fact, has the
interesting effect that people born on May 28th 1972, and several
other dates have persistent problems in entering their birthdays on
Italian websites. Something which can be a major problem, if you for
example need to check in online for your plane.</p><p>Alessandro Amici</p></div></div><div class="step" step="37" data-x="-10776" data-y="3891" data-rotate-z="-125.99577071418946"><pre class="highlight code javascript"><span class="nx">js</span><span class="o">&gt;</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">y</span><span class="p">,</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">d</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
<span class="nx">Sun</span> <span class="nx">May</span> <span class="mi">28</span> <span class="mi">1972</span> <span class="mi">12</span><span class="o">:</span><span class="mi">00</span><span class="o">:</span><span class="mi">00</span> <span class="nx">GMT</span><span class="o">+</span><span class="mi">0200</span> <span class="p">(</span><span class="nx">CEST</span><span class="p">)</span></pre><div class="notes"><p>To avoid this in <em>your</em> Javascript code, add a couple of hours in the check.
To be safe, add 12 hours. No-one does DST changes at noon.</p><p>Python of course, does <em>not</em> have this problem, because Python stores the
local date and time. But that has another side effect, although a much
smaller one.</p></div></div><div class="step" step="38" data-x="-11575" data-y="2437" data-rotate-z="-111.59464290463579"><h1 id="python-timezones">Python &amp; Timezones</h1><div class="notes"><p>And then it's time to talk about timezones and Python.</p></div></div><div class="step" step="39" data-x="-11988" data-y="829" data-rotate-z="-97.19351509508208"><h1 id="python-2-3-3-1">Python 2.3 - 3.1</h1><p>Abstract class <tt>tzinfo</tt> only</p><h1 id="python-3-2-3-3">Python 3.2 - 3.3</h1><p><tt>timezone</tt> class for fixed offsets</p><h1 id="python-3-4">Python 3.4?</h1><p>PEP-431: Full zoneinfo support</p><div class="notes"><p>The datetime library has support for handling timezones, via the tzinfo
type. However, the Python 2 stdlib doesn't include any actual tzinfo
objects, and in Python 3.2 and 3.3 only fixed offsets are supported.</p><p>PEP-431 is in the works, and will include full time zone support in
the Python stdlib, finally.</p></div></div><div class="step" step="40" data-x="-11988" data-y="-829" data-rotate-z="-82.80648490495501"><h1 id="pytz-or-dateutil"><tt>pytz</tt> or <tt>dateutil</tt>?</h1><p>Let's have a shootout!</p><div class="notes"><p>For this you need to use one of two available timezone libraries, pytz or
dateutil. Both wrap (and include) the zoneinfo database. pytz is updated each
time the zoneinfo database is updated. Dateutil is not updated when the
zoneinfo database is, so it's database is often outdated.</p></div></div><div class="step" step="41" data-x="-11575" data-y="-2437" data-rotate-z="-68.40535709540028"><h1 id="pytz-has-the-latest-zoneinfo-database"><tt>pytz</tt> has the latest zoneinfo database</h1><h2 id="pytz-15-0-dateutil"><tt>pytz</tt> 15 - 0 <tt>dateutil</tt></h2><div class="notes"><p>Dateutil will on the other hand use the OS-provided zoneinfo
database, which the OS should keep updated.</p></div></div><div class="step" step="42" data-x="-10776" data-y="-3891" data-rotate-z="-54.004229285845604"><h1 id="dateutil-will-use-the-os-database"><tt>dateutil</tt> will use the OS database</h1><h2 id="pytz-15-15-dateutil"><tt>pytz</tt> 15 - 15 <tt>dateutil</tt></h2><div class="notes"><p>But of course Windows doesn't use zoneinfo, so it doesn't get updated on Windows.</p></div></div><div class="step" step="43" data-x="-9640" data-y="-5101" data-rotate-z="-39.603101476290924"><h1 id="but-not-on-windows">But not on Windows</h1><h2 id="pytz-30-15-dateutil"><tt>pytz</tt> 30 - 15 <tt>dateutil</tt></h2><div class="notes"><p>On the other hand Dateutil has a function to parse dates that has timezone support.</p></div></div><div class="step" step="44" data-x="-8239" data-y="-5990" data-rotate-z="-25.20197366673627"><h1 id="dateutil-can-parse-dates-with-time-zones"><tt>dateutil</tt> can parse dates with time zones</h1><h2 id="pytz-30-30-dateutil"><tt>pytz</tt> 30 - 30 <tt>dateutil</tt></h2><div class="notes"><p>When moving from daylight saving the clock is moved back one hour.
That opens up for an important question.</p></div></div><div class="step" step="45" data-x="-6660" data-y="-6503" data-rotate-z="-10.800845857181551"><h1 id="which-half-past-two-do-you-mean">Which half past two do you mean?</h1><div class="notes"><p>Switching from 3am to 2am means these times happen twice.
The way to solve it is to internally always use UTC for the dates,
and only change them to other timezones for display.</p><p>That solves the problem of which half past three you mean
internally but when you display it, it still says only half past
three, and it will be unclear to the human reading it. Scheduling
meetings in the middle of the night during DST switchover is hence
inadvisable, but sometimes unavoidable.</p></div></div><div class="step" step="46" id="romanbug" data-x="-5004" data-y="-6608" data-rotate-z="3.6002819523730483"><pre class="highlight code python"><span class="o">&gt;&gt;&gt;</span> <span class="n">rome</span> <span class="o">=</span> <span class="n">pytz</span><span class="o">.</span><span class="n">timezone</span><span class="p">(</span><span class="s">'Europe/Rome'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rome</span><span class="o">.</span><span class="n">localize</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1972</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">is_dst</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s">"&lt;stdin&gt;"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
  <span class="n">File</span> <span class="s">"/usr/lib/python2.7/dist-packages/pytz/tzinfo.py"</span><span class="p">,</span>
    <span class="n">line</span> <span class="mi">322</span><span class="p">,</span> <span class="ow">in</span> <span class="n">localize</span>
    <span class="k">raise</span> <span class="n">NonExistentTimeError</span><span class="p">(</span><span class="n">dt</span><span class="p">)</span>
<span class="n">pytz</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NonExistentTimeError</span><span class="p">:</span> <span class="mi">1972</span><span class="o">-</span><span class="mo">05</span><span class="o">-</span><span class="mi">28</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span>
<span class="o">&gt;&gt;&gt;</span></pre><div class="notes"><p>And you also will have date inputs or imports in the local timezone,
so when you create date objects you need to have a way to specify if
the date time is in daylight saving or not.</p><p>Here is one of the flaws of the datetime library. There is in the
datetime API no way to specify which of the two half-past two's you mean.</p><p>pytz solves that, by using it's own API, in fact.
Dateutil, like the datetime library, ignores the problem.</p></div></div><div class="step" step="47" data-x="-3374" data-y="-6297" data-rotate-z="18.0014097619277"><h1 id="pytz-has-better-dst-handling"><tt>pytz</tt> has better DST handling</h1><h2 id="pytz-40-30-dateutil"><tt>pytz</tt> 40 - 30 <tt>dateutil</tt></h2><div class="notes"><p>It's not always possible to figure out the tz name of your
computers timezone. This means that you have to in any application
dealing with calendaring have the ability to specify the time zone in
the applications configuration. Looking at the TZ environment
variable, for example.</p><p>On the other hand, dateutil.tz has very handy classes for using your
computers timezone, one for Unix/OSX and one for Windows. These classes will
load whatever timezone you are in, without you having to figure it out.</p></div></div><div class="step" step="48" data-x="-1872" data-y="-5590" data-rotate-z="32.40253757148238"><h1 id="dateutil-has-better-local-time-zone-support"><tt>dateutil</tt> has better local time zone support</h1><h2 id="pytz-40-40-dateutil"><tt>pytz</tt> 40 - 40 <tt>dateutil</tt></h2><div class="notes"><p>Dateutil is catching up!</p></div></div><div class="step" step="49" data-x="-594" data-y="-4532" data-rotate-z="46.803665381036915"><h1 id="tzlocal"><tt>tzlocal</tt></h1><p>Local time zone support for <tt>pytz</tt></p><p><a href="http://pypi.python.org/pypi/tzlocal">http://pypi.python.org/pypi/tzlocal</a></p><div class="notes"><p>However, I recently made a module called tzlocal, that will return your
computers timezone, for use with pytz, solving that problem.</p></div></div><div class="step" step="50" data-x="381" data-y="-3189" data-rotate-z="61.2047931905917"><h1 id="advantage-pytz">Advantage <tt>pytz</tt></h1></div><div class="step" step="51" data-x="992" data-y="-1646" data-rotate-z="75.60592100014648"><h1 id="pep-431-is-based-on-pytz">PEP-431 is based on <tt>pytz</tt></h1><p>But not the API</p></div><div class="step" step="52" data-x="5992" data-y="-1646" data-rotate-z="0"><h1 id="parsing-timezones">Parsing timezones</h1><div class="notes"><p>Since the stdlib doesn't contain any real tz support it will of
course not help you parse date times with timezone info. But dateutil
will. It's quite intelligent about the format as well, and supports
all common formats, like RFC822 for mail headers.</p></div></div><div class="step" step="53" data-y="-646" data-x="5992"><h1 id="rfc-822-format">RFC 822 format</h1><pre class="highlight code python"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">dateutil.parser</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">parse</span><span class="p">(</span><span class="s">'2003-09-25 12:45 -0300'</span><span class="p">)</span>
<span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span>
        <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzoffset</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">10800</span><span class="p">))</span></pre><div class="notes"><p>So, you put in a date with a offset that is GMT minus three hours, and
you get a timezone offset that is minus three hours, or ten thousand 800
seconds.</p><p>It also supports POSIX.</p></div></div><div class="step" step="54" data-x="5992" data-y="353"><h1 id="posix-format">POSIX format</h1><pre class="highlight code python"><span class="o">&gt;&gt;&gt;</span> <span class="n">parse</span><span class="p">(</span><span class="s">'2003-09-25 12:45 GMT-0300'</span><span class="p">)</span>
<span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span>
        <span class="n">tzinfo</span><span class="o">=</span><span class="n">tzoffset</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">10800</span><span class="p">))</span></pre></div><div class="step" step="55" data-x="5992" data-y="1353"><p>Wait what?</p></div><div class="step" step="56" data-y="353" data-x="5992"><div class="notes"><p>But with POSIX, it's not so easy.</p><p>For some reason, probably just another of these stupid moments,
POSIX has the sign of the time offset wrong, leading to things like
what you see here. You enter an offset of GMT minus three hours, and
you get GMT + three hours.</p><p>The parse function will give a correct, negative offset in the first example,
but in the second example it will assume you are using a POSIX format, and
change the sign. Because POSIX says so.</p></div></div><div class="step" step="57" data-y="353" data-x="6992"><h1 id="icalendar">iCalendar</h1><h2 id="rfc-5545-rfc-2445">RFC 5545 / RFC 2445</h2><div class="notes"><p>Parsing dates are of course something mostly done when you need to talk
to other systems. Often this is just a question of parsing timestamps in
a particular format. But sometimes you need to import or export
calendaring data, and then there is a standard.</p><p>iCalendar is designed by The Internet Engineering Task Force Calendaring
and Scheduling Working Group and by that name you realize that it's
designed by committee, and therefore is amazingly complex.</p><p>RFC 5545 is he newer version of iCalendar that does take away some of the
complexities, but of course, most software still generate the old
version, so you still need to support all that complexity.</p><p>For example, you can define an event with a start date, that has several
recurrence rules that runs in parallel as well as a list of specific
dates outside that rule where the event also should happen. To make it
even more fun you not only also have a list of exclusion dates when it
should not happen, you have exclusion rules as well, of which you also
can have several!</p><p>Now why would you want that?</p></div></div><div class="step" step="58" data-y="353" data-rotate-x="-90" data-x="6992"><h1 id="the-python-secret-underground-meeting-schedule">The Python Secret Underground meeting schedule</h1><p>First meeting: Saturday 28th of August 1999</p><p>Every Last Saturday of the month, except in August, when it's the 28th.
And also, every 13th of every month, unless it's a Friday.</p><div class="notes"><p>Well, rumour has it that the Python Secret Underground needed it for their
meeting schedule.</p></div></div><div class="step" step="59" data-rotate-x="0" data-x="6992" data-y="353"><div class="notes"><p>But of course, the PSU does not exist, so that can't be true.</p></div></div><div class="step" step="60" data-x="8592" data-y="353"><table cellpadding="0" cellspacing="0"><tbody><tr><td></td><td><p>SECONDLY</p></td><td><p>MINUTELY</p></td><td><p>HOURLY</p></td><td><p>DAILY</p></td><td><p>WEEKLY</p></td><td><p>MONTHLY</p></td><td><p>YEARLY</p></td></tr><tr><td><p>BYMONTH</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Expand</p></td></tr><tr><td><p>BYWEEKNO</p></td><td><p>N/A</p></td><td><p>N/A</p></td><td><p>N/A</p></td><td><p>N/A</p></td><td><p>N/A</p></td><td><p>N/A</p></td><td><p>Expand</p></td></tr><tr><td><p>BYYEARDAY</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>N/A</p></td><td><p>N/A</p></td><td><p>N/A</p></td><td><p>Expand</p></td></tr><tr><td><p>BYMONTHDAY</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>N/A</p></td><td><p>Expand</p></td><td><p>Expand</p></td></tr><tr><td><p>BYDAY</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Expand</p></td><td><p>Note 1</p></td><td><p>Note 2</p></td></tr><tr><td><p>BYHOUR</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td></tr><tr><td><p>BYMINUTE</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td></tr><tr><td><p>BYSECOND</p></td><td><p>Limit</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td><td><p>Expand</p></td></tr><tr><td><p>BYSETPOS</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td><td><p>Limit</p></td></tr></tbody></table><div class="notes"><p>To make matter even more fun, the recurrence rules in themselves are
amazingly complex. Of course you must be able to have both weekly and monthly
and daily and yearly rules, and rules like the second to last Thursday of
every third month. Fine. But only a committee including Microsoft would allow
you to have all of them at once in one rule, allowing such weirdness as
having a BYMONTH and a BYHOUR value in a WEEKLY recurrence, resulting in a
couple of pages worth of discussion in what these things actually mean.</p></div></div><div class="step" step="61" data-x="10192" data-y="353" data-rotate-z="-93.60676685733615"><h1 id="dateutil-rrule">dateutil.rrule</h1><p>Implements all this so you don't have to!</p><div class="notes"><p>Again the recommendation for all of this is to use a library. And
here you don't have a choice. You need to use dateutil for recurrence.
dateutil has an rrule module which handles these things.</p></div></div><div class="step" step="62" data-x="9813" data-y="-1303" data-rotate-z="-115.71932057836845"><h1 id="using-a-timezone-in-icalendar">Using a timezone in iCalendar</h1><pre class="highlight code">DTSTART;TZID=America/New_York:19980119T020000</pre><div class="notes"><p>In iCalendar you can of course specify time zones for times.
But, you need to define the time zone</p></div></div><div class="step" step="63" id="tzdefinition" data-x="8753" data-y="-2632" data-rotate-z="-141.4315923470107"><h1 id="you-must-define-the-zone">You must  define the zone</h1><pre class="highlight code">BEGIN:VTIMEZONE
TZID:America/New_York
LAST-MODIFIED:20050809T050000Z
BEGIN:DAYLIGHT
DTSTART:19670430T020000
RRULE:FREQ=YEARLY;BYMONTH=4;BYDAY=-1SU;UNTIL=19730429T070000Z
TZOFFSETFROM:-0500
TZOFFSETTO:-0400
TZNAME:EDT
END:DAYLIGHT
BEGIN:STANDARD
DTSTART:19671029T020000
RRULE:FREQ=YEARLY;BYMONTH=10;BYDAY=-1SU;UNTIL=20061029T060000Z
TZOFFSETFROM:-0400
TZOFFSETTO:-0500
TZNAME:EST
END:STANDARD
BEGIN:DAYLIGHT
DTSTART:19740106T020000
RDATE:19750223T020000
TZOFFSETFROM:-0500
TZOFFSETTO:-0400
TZNAME:EDT
END:DAYLIGHT
BEGIN:DAYLIGHT
DTSTART:19760425T020000
RRULE:FREQ=YEARLY;BYMONTH=4;BYDAY=-1SU;UNTIL=19860427T070000Z
TZOFFSETFROM:-0500
TZOFFSETTO:-0400
TZNAME:EDT
END:DAYLIGHT
BEGIN:DAYLIGHT
DTSTART:19870405T020000
RRULE:FREQ=YEARLY;BYMONTH=4;BYDAY=1SU;UNTIL=20060402T070000Z
TZOFFSETFROM:-0500
TZOFFSETTO:-0400
TZNAME:EDT
END:DAYLIGHT
BEGIN:DAYLIGHT
DTSTART:20070311T020000
RRULE:FREQ=YEARLY;BYMONTH=3;BYDAY=2SU
TZOFFSETFROM:-0500
TZOFFSETTO:-0400
TZNAME:EDT
END:DAYLIGHT
BEGIN:STANDARD
DTSTART:20071104T020000
RRULE:FREQ=YEARLY;BYMONTH=11;BYDAY=1SU
TZOFFSETFROM:-0400
TZOFFSETTO:-0500
TZNAME:EST
END:STANDARD
END:VTIMEZONE</pre></div><div class="step" step="64" id="goodenough" data-x="7222" data-y="-3370" data-rotate-z="-167.14386411565297"><h1 id="good-enough">Good enough</h1><pre class="highlight code">DTSTART:19980119T080000Z
DTSTART:19980119T020000</pre><div class="notes"><p>Other lovely subtleties is that because Microsoft as involved, you can't
just specify timezones with the zoneinfo name. No, you have to include and
define the timezones in the iCalendar file itself. The way to do that is:
Try to avoid it, and send all dates without timezones or in UTC.</p></div></div><div class="step" step="65" data-x="5522" data-y="-3370" data-rotate-z="-192.85613588429524"><h1 id="the-icalendar-module">The <tt>icalendar</tt> module</h1><ul><li>No Python 3 support (yet)</li><li>Bugs in advanced cases</li><li>Good enough</li></ul><div class="notes"><p>At least you don't have to parse and generate the files yourself,
there is an iCalendar module for Python, that's pretty good, although
it still has bugs in edge cases, and no Python 3 support yet.</p><p>I don't know of any iCalendar module for Javascript, so I've
started one, but it's far from finished. Google has a rrule
implementation, but it requires caja.</p></div></div><div class="step" step="66" data-x="3990" data-y="-2632" data-rotate-z="-218.5684076529376"><h1 id="further-considerations">Further considerations</h1><ul><li>Events with or without time zones?</li><li>Or both?</li><li>Different time zone for start and end?</li><li>Whole-day events?</li></ul><div class="notes"><p>All the problems of dates and times come together in calendaring
applications with some additional problems.</p><p>What about events that have no timezone, such as
holidays? You need to support it, but you might only need
to support it for whole-day event.</p><p>What about events that start in one timezone and end in another?
It could happen. Again, you can probably ignore it.</p></div></div><div class="step" step="67" data-x="2930" data-y="-1303" data-rotate-z="-244.28067942157983"><h1 id="user-interface">User interface</h1><ul><li>Local display formats</li><li>Event lists: Upcoming / previous</li><li>Day / week / month / year views</li><li>First day of week support</li></ul><div class="notes"><p>But the most time consuming problem in calendaring is probably the user interface.</p></div></div><div class="step" step="68" data-x="2552" data-y="353" data-rotate-z="-270.0"><h1 id="date-inputs-the-text-field">Date inputs: The text field</h1><img src="images/textinput.png" alt="" width="" height=""></img><ul><li>Fast entry</li><li>Input format always a problem</li></ul><div class="notes"><p>How do you enter a date and time in a nice way? Just typing it in would
be a reasonable choice if there was a standard for writing date. But
since 01/02/03 can mean 1st of February 2003 or second of January 2003 or
third of February 2001, that's not an option. People will not know what
format to write.</p><p>Writing the format besides the input doesn't help, becuase people don't
don't. Not even popup boxes with big red STOP signs.</p></div></div><div class="step" step="69" data-x="2930" data-y="2010" data-rotate-z="64.28067942168637"><h1 id="the-date-picker">The date picker</h1><img src="images/datepicker.png" alt="" width="" height=""></img><ul><li>Most common solution</li><li>Not accessible</li><li>Requires Javascript</li><li>Do not allow you to type in dates</li></ul><div class="notes"><p>The generic solution is a date picker, a little calendar that pops up.
This doesn't support enter hours an minutes, which is a nice feature to
have. I've seen solutions with sliders for entering hours and minutes,
which seems to work well.</p></div></div><div class="step" step="70" data-x="3990" data-y="3339" data-rotate-z="38.568407653022135"><h1 id="the-drop-down-list">The drop down list</h1><img src="images/dropdown.png" alt="" width="" height=""></img><ul><li>Slow to use</li><li>Accessible</li><li>Doesn't allow you to type in dates</li></ul><div class="notes"><p>But if you have a website you want your site to work without Javascript
for accessibility reasons. Drop down lists is a good option,
although you get a problem with minutes. You need either really long drop
down boxes, or you need to list only five minute intervals. Neither are a
good solutions.</p></div></div><div class="step" step="71" data-x="5522" data-y="4077" data-rotate-z="12.856135884357768"><img src="images/UbuntuTimezonePicker.png" alt="" width="" height=""></img><div class="notes"><p>Timezone selection also has the same problem of being a really long list.</p><p>Also this doesn't allow you to type in dates. That is a problem
you also have with many date pickers, they block the entry field. Both
drop-downs and date pickers are slow to use with a lot of clicking.
Entering a lot of dates quickly gets very annoying.</p><p>So try to have a way to enter dates by typing them in.</p><p>Also, there should be a check box saying that this event goes on for the whole day,
and preferably, the end date should be optional.</p></div></div><div class="step" step="72" data-x="7222" data-y="4077" data-rotate-z="-12.856135884306246"><img src="images/screenshot.jpg" alt="" width="" height=""></img><div class="notes"><p>Displaying a whole calendar is a nightmare of it's own. In a week or day
view you need to position the events correctly during the day, and you
want multiple events that happen at the same time to not block each other
You also by default want to show just the work-hours, but events outside
these hours should still be visible somehow. Tricky stuff.</p><p>And how to show all day events? Well, a common solution is to have a
special all-day even line at the top, as this example shows of a
Javascript calendar called fullcalendar. FUllcalendar is a good
alternative to writing your own if you are working on the web, and OK
with a JS calendar.</p><p>Main problem is that there is no indication that you have an event that
is outside the time shown.</p></div></div><div class="step" step="73" id="recurrenceinput" data-x="8753" data-y="3339" data-rotate-z="-38.56840765297057"><h1 id="jquery-recurrenceinput">jquery.recurrenceinput</h1><img src="images/Screenshot.png" alt="" width="312px" height="500px"></img><p><a href="https://github.com/collective/jquery.recurrenceinput.js">https://github.com/collective/jquery.recurrenceinput.js</a></p><div class="notes"><p>An making a nice easy to use UI for recurrence rules is, well,
impossible. There are just too many options. You have to limit
yourself.</p><p>There is a widget, I wrote most it, it took months. Hexagon IT
payed for it.</p></div></div><div class="step" step="74" data-x="9813" data-y="2010" data-rotate-z="-64.28067942163469"><p><a href="http://regebro.wordpress.com/">http://regebro.wordpress.com/</a></p><div class="notes"><p>Believe or not, there are things about calendaring
that is fun and interesting too! But I didn't have time
for that, it would have made this talk at least 30m longer.</p><p>But I have written these things up on G+ and hope
to make blog-posts about it soon, so keep your eyes open!</p></div></div><div class="step" step="75" data-scale="30" data-x="-5000" data-y="0" data-rotate-z="-64.28067942163469"><p>Q?</p><div class="notes"><p>Questions?</p></div></div><div class="step" step="76" data-scale="10" data-x="0" data-y="10000" data-rotate-z="-64.28067942163469"><h1 id="creaditus-generalus">Creaditus Generalus</h1><p><strong>Presentation software:</strong></p><p>Hovercraft</p><p><tt>https://github.com/regebro/hovercraft</tt></p><p><strong>Fonts:</strong></p><p>Cinzel by Natanael Gama</p><p>DejaVu Mono Book</p></div></div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Left, Down, Page Down</th><td>Next slide</td></tr><tr><th>Right, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>